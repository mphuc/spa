<?phpclass ControllerReportExportCustomerid extends Controller {	// hoa hong truc tiep	public function export_r_wallet() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->model('pd/registercustom');				$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_pd_registercustom -> getall_r_wallet();				if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>#nodata");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Tên tài khoản')		->setCellValue('D1', 'Số tài khoản')		->setCellValue('E1', 'Số PV')		->setCellValue('F1', 'Số Tiền')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số điện thoại');         $objPHPExcel->getActiveSheet()->getStyle('A1:I1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => 'e56c0e')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:L1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$h=0;		$n = 2;		$i=0;		$tongtien = 0;		foreach ($results as $customer) {			// bk r_wallet			$this -> model_pd_registercustom -> insert_r_wallet_bk($customer['customer_id'],$customer['amount']);			//update ví r = 0			$this -> model_pd_registercustom ->update_r_wallet0($customer['customer_id']);			// lưu lịch sử						$id_history = $this -> model_pd_registercustom -> saveTranstionHistory(            $customer['customer_id'],            'Trả hoa hồng trực tiếp',             '- ' . ($customer['amount']/1000) . ' PV',            "Rút hoa hồng trực tiếp (". (number_format($customer['amount']*27)) ." VNĐ)");			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n," ".($customer['amount']/1000)." PV");			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,number_format(doubleval($customer['amount']*27)));			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n," ".$customer['telephone']);			$n++;			$tongtien += doubleval($customer['amount']*27);		}		$dong = $n+1;		$objPHPExcel->getActiveSheet()->setCellValue('E'.$dong,"Tổng Tiền");		$objPHPExcel->getActiveSheet()->setCellValue('F'.$dong,number_format($tongtien));		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="HOA_HONG_TRUC_TIEP_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}		// hoa hong truc tiep	public function export_hh_wallet() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->model('pd/registercustom');				$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_pd_registercustom -> getall_hh_wallet();				if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>#nodata");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Tên tài khoản')		->setCellValue('D1', 'Số tài khoản')		->setCellValue('E1', 'Số PV')		->setCellValue('F1', 'Số Tiền')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số điện thoại');         $objPHPExcel->getActiveSheet()->getStyle('A1:I1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '5bc0de')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:I1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$h=0;		$n = 2;		$i=0;		$tongtien = 0;		foreach ($results as $customer) {			// bk r_wallet			$this -> model_pd_registercustom -> insert_hh_wallet_bk($customer['customer_id'],$customer['amount']);			//update ví r = 0			$this -> model_pd_registercustom ->update_hh_wallet0($customer['customer_id']);			// lưu lịch sử						$id_history = $this -> model_pd_registercustom -> saveTranstionHistory(            $customer['customer_id'],            'Trả hoa hồng trên thu nhập trực tiếp của F1',             '- ' . ($customer['amount']/1000) . ' PV',            "Rút hoa hồng trên thu nhập trực tiếp của F1 (". (number_format($customer['amount']*27)) ." VNĐ)");			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n," ".($customer['amount']/1000)." PV");			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,number_format(doubleval($customer['amount']*27)));			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n," ".$customer['telephone']);			$n++;			$tongtien += doubleval($customer['amount']*27);		}		$dong = $n+1;		$objPHPExcel->getActiveSheet()->setCellValue('E'.$dong,"Tổng Tiền");		$objPHPExcel->getActiveSheet()->setCellValue('F'.$dong,number_format($tongtien));		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="HOA_HONG_TREN_THU_NHAP_TRUC_TIEP_F1_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}	// hoa hong truc tiep	public function export_km_wallet() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->model('pd/registercustom');				$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_pd_registercustom -> getall_km_wallet();				if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>#nodata");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Tên tài khoản')		->setCellValue('D1', 'Số tài khoản')		->setCellValue('E1', 'Số PV')		->setCellValue('F1', 'Số Tiền')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số điện thoại');         $objPHPExcel->getActiveSheet()->getStyle('A1:I1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '064B75')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:I1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$h=0;		$n = 2;		$i=0;		$tongtien = 0;		foreach ($results as $customer) {			// bk r_wallet			$this -> model_pd_registercustom -> insert_km_wallet_bk($customer['customer_id'],$customer['amount']);			//update ví r = 0			$this -> model_pd_registercustom ->update_km_wallet0($customer['customer_id']);			// lưu lịch sử						$id_history = $this -> model_pd_registercustom -> saveTranstionHistory(            $customer['customer_id'],            'Trả đồng chia tổng doanh sô',             '- ' . ($customer['amount']/1000) . ' PV',            "Rút hoa hồng đồng chia tổng doanh sô (".(number_format($customer['amount']*27))." VNĐ)");			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n," ".($customer['amount']/1000)." PV");			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,number_format(doubleval($customer['amount']*27)));			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n," ".$customer['telephone']);			$n++;			$tongtien += doubleval($customer['amount']*27);		}		$dong = $n+1;		$objPHPExcel->getActiveSheet()->setCellValue('E'.$dong,"Tổng Tiền");		$objPHPExcel->getActiveSheet()->setCellValue('F'.$dong,number_format($tongtien));		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="DONG_CHIA_TONG_DOANH_SO_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}	public function export_ln_wallet() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->model('pd/registercustom');				$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_pd_registercustom -> getall_ln_wallet();				if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>#nodata");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Tên tài khoản')		->setCellValue('D1', 'Số tài khoản')		->setCellValue('E1', 'Số PV')		->setCellValue('F1', 'Số Tiền')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số điện thoại');         $objPHPExcel->getActiveSheet()->getStyle('A1:I1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => 'f24545')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:I1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$h=0;		$n = 2;		$i=0;		$tongtien = 0;		foreach ($results as $customer) {			// bk r_wallet			$this -> model_pd_registercustom -> insert_ln_wallet_bk($customer['customer_id'],$customer['amount']);			//update ví r = 0			$this -> model_pd_registercustom ->update_ln_wallet0($customer['customer_id']);			// lưu lịch sử						$id_history = $this -> model_pd_registercustom -> saveTranstionHistory(            $customer['customer_id'],            'Trả hoa hồng chia lợi nhuận chuỗi spa',             '- ' . ($customer['amount']/1000) . ' PV',            "Rút hoa hồng chia lợi nhuận chuỗi spa (".(number_format($customer['amount']*27))." VNĐ)");			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n," ".($customer['amount']/1000)." PV");			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,number_format(doubleval($customer['amount']*27)));			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n," ".$customer['telephone']);			$n++;			$tongtien += doubleval($customer['amount']*27);		}		$dong = $n+1;		$objPHPExcel->getActiveSheet()->setCellValue('E'.$dong,"Tổng Tiền");		$objPHPExcel->getActiveSheet()->setCellValue('F'.$dong,number_format($tongtien));		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="CHIA_LOI_NHUAN_CHUOI_SPA_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}	public function export_ch_wallet() {		error_reporting(E_ALL);		ini_set('display_errors', TRUE);		ini_set('display_startup_errors', TRUE);		date_default_timezone_set('Europe/London');		if (PHP_SAPI == 'cli')		die('This example should only be run from a Web Browser');		require_once dirname(__FILE__) . '/PHPExcel.php';		$this->load->model('pd/registercustom');				$this -> session ->data['laihangngay'] = "laihangngay";		$results = $this -> model_pd_registercustom -> getall_ch_wallet();				if (count($results) == 0){			$this -> session ->data['laihangngay'] = "nodata";		?>		<script type="text/javascript">			window.location.replace("index.php?route=pd/statistical&token=<?php echo $_GET['token'];?>#nodata");		</script>		<?php		}		//print_r($results); die;				!count($results) > 0 && die('no data!');		$objPHPExcel = new PHPExcel();		$objPHPExcel->getProperties()->setCreator("Hoivien")						 ->setLastModifiedBy("Hoivien")						 ->setTitle("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setSubject("Office 2007 XLSX".$this->language->get('heading_title'))						 ->setDescription($this->language->get('heading_title'))						 ->setKeywords("office 2007 openxml php")						 ->setCategory("Test result file");		$objPHPExcel->setActiveSheetIndex(0)		->setCellValue('A1', 'STT')		->setCellValue('B1', 'Username')		->setCellValue('C1', 'Tên tài khoản')		->setCellValue('D1', 'Số tài khoản')		->setCellValue('E1', 'Số PV')		->setCellValue('F1', 'Số Tiền')        ->setCellValue('G1', 'Ngân hàng')        ->setCellValue('H1', 'Chi nhánh')        ->setCellValue('I1', 'Số điện thoại');         $objPHPExcel->getActiveSheet()->getStyle('A1:I1')        ->applyFromArray(                array(                    'fill' => array(                        'type' => PHPExcel_Style_Fill::FILL_SOLID,                        'color' => array('rgb' => '5c843d')                    )                )            );            $styleArray = array(                'font'  => array(                    'bold'  => true,                    'color' => array('rgb' => 'FFFFFF'),                    'size'  => 12,                    'name'  => 'Arial'                ));        $objPHPExcel->getActiveSheet()->getStyle('A1:I1')->applyFromArray($styleArray);		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);		$h=0;		$n = 2;		$i=0;		$tongtien = 0;		foreach ($results as $customer) {			// bk r_wallet			$this -> model_pd_registercustom -> insert_ch_wallet_bk($customer['customer_id'],$customer['amount']);			//update ví r = 0			$this -> model_pd_registercustom ->update_ch_wallet0($customer['customer_id']);			// lưu lịch sử						$id_history = $this -> model_pd_registercustom -> saveTranstionHistory(            $customer['customer_id'],            'Trả hoa hồng cộng hưởng',             '- ' . ($customer['amount']/1000) . ' PV',            "Rút hoa hồng cộng hưởng (".(number_format($customer['amount']*27))." VNĐ)");			$i++;			//print_r($customer); die;			$objPHPExcel->getActiveSheet()->setCellValue('A'.$n,$i);			$objPHPExcel->getActiveSheet()->setCellValue('B'.$n," ".$customer['username']);			$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$customer['account_holder']);			$objPHPExcel->getActiveSheet()->setCellValue('D'.$n," ".$customer['account_number']);			$objPHPExcel->getActiveSheet()->setCellValue('E'.$n," ".($customer['amount']/1000)." PV");			$objPHPExcel->getActiveSheet()->setCellValue('F'.$n,number_format(doubleval($customer['amount']*27)));			$objPHPExcel->getActiveSheet()->setCellValue('G'.$n,$customer['bank_name']);			$objPHPExcel->getActiveSheet()->setCellValue('H'.$n,$customer['branch_bank']);			$objPHPExcel->getActiveSheet()->setCellValue('I'.$n," ".$customer['telephone']);			$n++;			$tongtien += doubleval($customer['amount']*27);		}		$dong = $n+1;		$objPHPExcel->getActiveSheet()->setCellValue('E'.$dong,"Tổng Tiền");		$objPHPExcel->getActiveSheet()->setCellValue('F'.$dong,number_format($tongtien));		$objPHPExcel->getActiveSheet()->getStyle('N'.$n.':'.'P'.$n)		->applyFromArray(			array('font'  => array(				'bold'  => true,				'size'  => 12,				'name'  => 'Arial'			))		);		// Rename worksheet		$objPHPExcel->getActiveSheet()->setTitle($this->language->get('heading_title'));		// Set active sheet index to the first sheet, so Excel opens this as the first sheet		$objPHPExcel->setActiveSheetIndex(0);					date_default_timezone_set('Asia/Ho_Chi_Minh');		// Redirect output to a client’s web browser (Excel5)		header('Content-Type: application/vnd.ms-excel');		header('Content-Disposition: attachment;filename="HOA_HONG_CONG_HUONG_'.date('d').'_'.date('m').'_'.date('Y').'_'.date('H').'_'.date('i').'.xls"');		header('Cache-Control: max-age=0');		// If you're serving to IE 9, then the following may be needed		header('Cache-Control: max-age=1');		// If you're serving to IE over SSL, then the following may be needed		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1		header ('Pragma: public'); // HTTP/1.0		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');		$objWriter->save('php://output');				exit;	}	}